<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - LevelUp Kids</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
  <style>
    /* mantém o estilo 8-bit */
    body { background-color: #1a1a2e; color: #f8f8f2; text-align: center; }
    .logo { width: 140px; margin: 30px auto; display: block; }
    .grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin: 20px auto; max-width: 800px; }
    .card { background-color: #0f3460; border: 2px solid #5dadec; width: 150px; height: 150px; padding: 10px; border-radius: 8px; transition: 0.2s; cursor: pointer; }
    .card:hover { transform: scale(1.05); background-color: #16213e; }
    .btn { background: #e94560; border: 2px solid white; padding: 10px; color: white; font-size: 10px; text-decoration: none; margin-top: 5px; display: inline-block; cursor: pointer; }
  </style>
  <script>
    async function loadKids() {
      const parent_id = localStorage.getItem("parent_id");
      if (!parent_id) {
        window.location.href = "/login";
        return;
      }

      const grid = document.getElementById("grid");
      grid.innerHTML = "<p>Carregando heróis...</p>";

      try {
        const response = await fetch(`http://127.0.0.1:8000/v1/kid?parent_id=${parent_id}`);
        const kids = await response.json();
        grid.innerHTML = "";

        kids.forEach(kid => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="/static/img/avatar1.png" alt="Avatar">
            <p>${kid.nome}</p>
            <a href="/game" class="btn">Entrar</a>
          `;
          grid.appendChild(card);
        });

        // card adicional para criar novo herói
        const addCard = document.createElement("div");
        addCard.className = "card";
        addCard.innerHTML = `
          <img src="/static/img/add.png" alt="Novo">
          <p>Novo Herói</p>
          <button class="btn" onclick="addKid()">Criar</button>
        `;
        grid.appendChild(addCard);

      } catch (err) {
        grid.innerHTML = "<p>Erro ao carregar heróis.</p>";
      }
    }

    async function addKid() {
      const nome = prompt("Nome do novo herói:");
      const idade = prompt("Idade:");
      const parent_id = localStorage.getItem("parent_id");

      if (!nome || !idade) return;

      await fetch("http://127.0.0.1:8000/v1/kid", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome, idade: parseInt(idade), parent_id })
      });

      loadKids(); // recarrega a lista
    }

    window.onload = loadKids;
  </script>
</head>
<body>
  <img src="/static/img/logo.png" alt="LevelUp Kids" class="logo">
  <h1>Selecione o Herói</h1>
  <div class="grid" id="grid"></div>
  <div class="footer">
    <a href="/manage" class="btn">Gerenciar Missões & Recompensas</a>
  </div>
</body>
</html>
